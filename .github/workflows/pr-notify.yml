name: PR Format Notification
on:
  pull_request_target:
    types: [opened, reopened]

jobs:
  notify-format:
    if: github.repository == 'kurisaW/code-format'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    
    steps:
      - name: Create format notification
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // è·å–PRä¿¡æ¯
            const forkRepo = '${{ github.event.pull_request.head.repo.full_name }}';
            const branch = '${{ github.event.pull_request.head.ref }}';
            
            // ç”Ÿæˆæ ¼å¼åŒ–å·¥ä½œæµé“¾æ¥
            const workflowUrl = `https://github.com/${forkRepo}/actions/workflows/astyle-format.yml`;
            const directLink = `${workflowUrl}?branch=${encodeURIComponent(branch)}`;
            
            // åˆ›å»ºè¯„è®ºæ¶ˆæ¯
            const message = [
              'ğŸ‘‹ ä½ å¥½ï¼æ„Ÿè°¢ä½ çš„è´¡çŒ®ã€‚ä¸ºäº†ä¿æŒä»£ç é£æ ¼ç»Ÿä¸€ï¼Œè¯·åœ¨ä½ çš„ä»“åº“ä¸­è¿è¡Œä»£ç æ ¼å¼åŒ–å·¥ä½œæµï¼š',
              '',
              'Hello! Thank you for your contribution. To maintain code style consistency, please run the code formatting workflow in your repository:',
              '',
              '**æ­¥éª¤ / Steps:**',
              '1. ğŸ“‹ **å‰å¾€ä½ çš„ä»“åº“ Actions é¡µé¢** / Go to your repository Actions page: [ç‚¹å‡»è¿™é‡Œ](' + directLink + ')',
              '2. âš¡ **è¿è¡Œæ ¼å¼åŒ–å·¥ä½œæµ** / Run the format workflow: Select "Code Format with Astyle" on the left',
              '3. ğŸš€ **ç‚¹å‡» "Run workflow"** / Click "Run workflow": Use default parameters or adjust as needed',
              '4. â³ **ç­‰å¾…å®Œæˆ** / Wait for completion: The formatted code will be automatically pushed to your branch',
              '',
              '**ç›´è¾¾é“¾æ¥** / Direct link: [è¿è¡Œæ ¼å¼åŒ–å·¥ä½œæµ / Run Format Workflow](' + directLink + ')',
              '',
              'æ ¼å¼åŒ–å®Œæˆåï¼Œcommit ä¼šè‡ªåŠ¨æ¨é€åˆ°ä½ çš„ `' + branch + '` åˆ†æ”¯ï¼ŒPR ä¼šè‡ªåŠ¨æ›´æ–°ã€‚',
              'After formatting, commits will be automatically pushed to your `' + branch + '` branch and the PR will update automatically.'
            ].join('\n');

            // åˆ›å»ºè¯„è®º
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: message
            });
            
            console.log('âœ… Format notification comment created');
